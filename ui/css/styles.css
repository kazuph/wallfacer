/* --- Theme variables --- */
:root, [data-theme="light"] {
  --bg: #dfe2e7;
  --bg-raised: #d3d7dd;
  --bg-card: #e8eaed;
  --bg-input: #d8dce2;
  --text: #313845;
  --text-secondary: #5a6374;
  --text-muted: #8c95a4;
  --accent: #4872b5;
  --accent-hover: #345d9e;
  --border: #bcc1cb;
  --shadow: 0 1px 3px rgba(0,0,0,0.07);
  --shadow-lg: 0 8px 24px rgba(0,0,0,0.11);
}
[data-theme="dark"] {
  --bg: #181c22;
  --bg-raised: #1f242c;
  --bg-card: #252b34;
  --bg-input: #1c2028;
  --text: #dde2ea;
  --text-secondary: #8e9baf;
  --text-muted: #5c6878;
  --accent: #5b8fd4;
  --accent-hover: #82aae0;
  --border: #2e3644;
  --shadow: 0 1px 3px rgba(0,0,0,0.25);
  --shadow-lg: 0 8px 24px rgba(0,0,0,0.45);
}

::selection { background: #555; color: #fff; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  line-height: 1.6;
}

/* --- Layout --- */
.column { flex: 1; min-height: 0; overflow-y: auto; }
.col-bg { background: var(--bg-raised); border-radius: 12px; padding: 12px; }

/* --- Cards --- */
.card {
  cursor: grab;
  transition: transform 0.15s, box-shadow 0.15s;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 12px;
}
.card:hover { transform: translateY(-1px); box-shadow: var(--shadow-lg); }
.card.sortable-ghost { opacity: 0.4; }
.card.sortable-chosen { box-shadow: var(--shadow-lg); }

/* --- Badges --- */
.badge { padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: 500; }
.badge-backlog { background: #d0d4db; color: #6b7584; }
.badge-in_progress { background: #cfddf5; color: #2c5b9a; }
.badge-waiting { background: #f0e6ce; color: #7a5810; }
.badge-committing { background: #f0e6ce; color: #7a5810; }
.badge-done { background: #cceadb; color: #1a6638; }
.badge-failed { background: #f0d3d3; color: #8c2424; }
.badge-archived { background: #d0d4db; color: #6b7584; font-style: italic; }
[data-theme="dark"] .badge-backlog { background: #2a3040; color: #7a8899; }
[data-theme="dark"] .badge-in_progress { background: #1a2d4a; color: #6da0dc; }
[data-theme="dark"] .badge-waiting { background: #352a10; color: #d4a030; }
[data-theme="dark"] .badge-committing { background: #352a10; color: #d4a030; }
[data-theme="dark"] .badge-done { background: #0e2e1e; color: #45b87a; }
[data-theme="dark"] .badge-failed { background: #341414; color: #d46868; }
[data-theme="dark"] .badge-archived { background: #2a3040; color: #7a8899; font-style: italic; }

/* --- Spinner --- */
.spinner {
  border: 2px solid var(--border);
  border-top-color: var(--accent);
  border-radius: 50%; width: 16px; height: 16px;
  animation: spin 0.8s linear infinite; display: inline-block;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* --- Modal --- */
.modal-overlay { background: rgba(0,0,0,0.3); backdrop-filter: blur(4px); }
[data-theme="dark"] .modal-overlay { background: rgba(0,0,0,0.6); }
.modal-card {
  background: var(--bg-card); border: 1px solid var(--border);
  border-radius: 16px; max-width: 672px; width: 100%;
  max-height: 95vh; overflow-y: auto; box-shadow: var(--shadow-lg);
}

/* --- Column headers --- */
.col-header { font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }
.col-header-backlog { color: var(--text-muted); }
.col-header-progress { color: #3a6db3; }
.col-header-waiting { color: #a07020; }
.col-header-done { color: #28804a; }
.col-header-failed { color: #a02828; }
[data-theme="dark"] .col-header-progress { color: #6da0dc; }
[data-theme="dark"] .col-header-waiting { color: #d4a030; }
[data-theme="dark"] .col-header-done { color: #45b87a; }
[data-theme="dark"] .col-header-failed { color: #d46868; }

/* --- Event type colors --- */
.ev-state { color: #3a6db3; }
.ev-output { color: #28804a; }
.ev-feedback { color: #a07020; }
.ev-error { color: #b02828; }
[data-theme="dark"] .ev-state { color: #6da0dc; }
[data-theme="dark"] .ev-output { color: #45b87a; }
[data-theme="dark"] .ev-feedback { color: #d4a030; }
[data-theme="dark"] .ev-error { color: #d46868; }

/* --- Form elements --- */
.field {
  background: var(--bg-input); border: 1px solid var(--border); color: var(--text);
  border-radius: 8px; padding: 12px; font-size: 14px; outline: none; width: 100%;
  font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace; resize: none;
  box-sizing: border-box;
}
.field::placeholder { color: var(--text-muted); }
.field:focus { border-color: var(--accent); }

.select {
  background: var(--bg-input); border: 1px solid var(--border); color: var(--text-secondary);
  border-radius: 4px; padding: 4px 8px; font-size: 12px; outline: none;
}
.select:focus { border-color: var(--accent); }

/* --- Buttons --- */
.btn { border: none; border-radius: 8px; padding: 6px 16px; font-size: 14px; font-weight: 500; cursor: pointer; }
.btn-accent { background: var(--accent); color: #fff; }
.btn-accent:hover { background: var(--accent-hover); }
.btn-yellow { background: #a07020; color: #fff; }
.btn-yellow:hover { background: #7a5518; }
.btn-green { background: #28804a; color: #fff; }
.btn-green:hover { background: #1f6438; }
.btn-ghost { background: transparent; color: var(--text-muted); border: none; padding: 6px 16px; font-size: 14px; cursor: pointer; }
.btn-ghost:hover { color: var(--text); }
.btn-dashed {
  width: 100%; border: 1px dashed var(--border); border-radius: 8px;
  padding: 8px 12px; font-size: 14px; color: var(--text-muted);
  background: transparent; cursor: pointer;
}
.btn-dashed:hover { color: var(--text-secondary); border-color: var(--text-muted); }
.btn-danger { color: #b02828; background: none; border: none; cursor: pointer; font-size: 14px; }
.btn-danger:hover { color: #8c1e1e; }
[data-theme="dark"] .btn-danger { color: #d46868; }
[data-theme="dark"] .btn-danger:hover { color: #e08888; }

/* --- Code / log blocks --- */
pre { white-space: pre-wrap; word-break: break-word; }
.code-block {
  background: var(--bg-input); border-radius: 8px; padding: 16px;
  font-size: 14px; color: var(--text-secondary);
}
.logs-block {
  background: #0d1117; border-radius: 8px; padding: 16px;
  font-size: 12px; color: #4ade80; max-height: 384px;
  overflow-y: auto; font-family: 'SF Mono', 'Fira Code', monospace;
}

/* --- Usage stats --- */
.usage-grid {
  background: var(--bg-input); border-radius: 8px; padding: 16px;
  display: grid; grid-template-columns: 1fr 1fr; gap: 4px 24px; font-size: 14px;
}
.usage-label { color: var(--text-muted); }
.usage-value { color: var(--text); font-family: 'SF Mono', 'Fira Code', monospace; text-align: right; }

/* --- Settings panel --- */
.settings-panel {
  position: absolute; top: 100%; right: 0; margin-top: 8px;
  background: var(--bg-card); border: 1px solid var(--border);
  border-radius: 12px; padding: 16px; min-width: 200px;
  box-shadow: var(--shadow-lg); z-index: 100;
}
.settings-btn {
  background: none; border: none; color: var(--text-muted);
  cursor: pointer; padding: 6px; display: flex; align-items: center;
  border-radius: 6px;
}
.settings-btn:hover { color: var(--text); }

.theme-switch {
  display: flex; background: var(--bg-input); border: 1px solid var(--border);
  border-radius: 8px; overflow: hidden;
}
.theme-switch button {
  flex: 1; padding: 6px 0; font-size: 12px; font-weight: 500;
  background: transparent; color: var(--text-muted);
  border: none; cursor: pointer;
}
.theme-switch button.active { background: var(--accent); color: #fff; }
.theme-switch button:hover:not(.active) { color: var(--text); }

/* --- Utility --- */
.text-v-primary { color: var(--text); }
.text-v-secondary { color: var(--text-secondary); }
.text-v-muted { color: var(--text-muted); }
.border-v { border-color: var(--border); }
.section-title { font-size: 16px; font-weight: 600; color: var(--text); margin-bottom: 8px; }

/* --- Icon buttons (toggle/copy) --- */
.btn-icon {
  background: none; border: 1px solid var(--border); color: var(--text-muted);
  border-radius: 5px; padding: 2px 7px; font-size: 11px; cursor: pointer;
  display: inline-flex; align-items: center; gap: 3px; line-height: 1.6;
}
.btn-icon:hover { color: var(--text); border-color: var(--text-muted); }

/* --- Markdown prose (modal detail view) --- */
.prose-content { font-size: 14px; line-height: 1.6; color: var(--text-secondary); }
.prose-content h1, .prose-content h2, .prose-content h3,
.prose-content h4, .prose-content h5, .prose-content h6 {
  font-weight: 600; line-height: 1.3; color: var(--text); margin: 0.75em 0 0.3em;
}
.prose-content h1 { font-size: 1.25em; }
.prose-content h2 { font-size: 1.1em; }
.prose-content h3 { font-size: 1em; }
.prose-content p { margin: 0.4em 0; }
.prose-content p:first-child { margin-top: 0; }
.prose-content p:last-child { margin-bottom: 0; }
.prose-content ul, .prose-content ol { padding-left: 1.5em; margin: 0.4em 0; }
.prose-content li { margin: 0.15em 0; }
.prose-content code {
  background: var(--bg); border-radius: 4px; padding: 1px 5px; font-size: 0.88em;
  font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace; color: var(--text);
}
.prose-content pre {
  background: var(--bg); border-radius: 6px; padding: 12px; overflow-x: auto;
  margin: 0.5em 0; font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;
  font-size: 13px; white-space: pre-wrap; word-break: break-word;
}
.prose-content pre code { background: none; padding: 0; font-size: inherit; }
.prose-content blockquote {
  border-left: 3px solid var(--border); padding-left: 1em;
  color: var(--text-muted); margin: 0.5em 0;
}
.prose-content a { color: var(--accent); text-decoration: none; }
.prose-content a:hover { text-decoration: underline; }
.prose-content hr { border: none; border-top: 1px solid var(--border); margin: 0.75em 0; }
.prose-content table { border-collapse: collapse; width: 100%; margin: 0.5em 0; font-size: 13px; }
.prose-content th, .prose-content td { border: 1px solid var(--border); padding: 5px 10px; text-align: left; }
.prose-content th { background: var(--bg-input); font-weight: 600; color: var(--text); }
.prose-content strong { font-weight: 600; color: var(--text); }

/* --- Diff block (waiting task cards) --- */
.diff-block {
  background: var(--bg-input);
  border: 1px solid var(--border);
  border-radius: 4px;
  padding: 4px 6px;
  font-size: 9px;
  line-height: 1.5;
  font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;
  max-height: 8em;
  overflow-y: auto;
  overflow-x: hidden;
  color: var(--text-secondary);
  white-space: pre-wrap;
  word-break: break-all;
  margin-top: 8px;
}
.diff-add { color: #1a6638; }
.diff-del { color: #8c2424; }
.diff-hunk { color: #2c5b9a; }
.diff-header { color: #7a5810; }
[data-theme="dark"] .diff-add { color: #3fb950; }
[data-theme="dark"] .diff-del { color: #ff7b72; }
[data-theme="dark"] .diff-hunk { color: #79c0ff; }
[data-theme="dark"] .diff-header { color: #e3b341; }

/* --- Markdown in card previews (compact overrides) --- */
.card-prose { }
.card-prose p { margin: 0 !important; }
.card-prose h1, .card-prose h2, .card-prose h3,
.card-prose h4, .card-prose h5, .card-prose h6 { margin: 0 0 0.1em !important; font-size: 1em !important; }
.card-prose ul, .card-prose ol { margin: 0 !important; padding-left: 1.2em !important; }
.card-prose li { margin: 0 !important; }
.card-prose pre { margin: 0 !important; padding: 2px 6px !important; font-size: 0.85em !important; }
.card-prose blockquote { margin: 0 !important; }
